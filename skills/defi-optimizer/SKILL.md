---
name: defi-optimizer
description: DeFi yield optimization with AAVE, Compound, Curve, Yearn. Safe stablecoin strategies, risk management, auto-rebalancing. High risk - requires supervisor approval.
auto_trigger: false
---

# DeFi Yield Optimizer

DeFiイールド最適化スキル。安全なステーブルコイン戦略とリスク管理。

## 🎯 目標

```yaml
最優先目標: 利益を出すこと

目標指標:
  - APY最大化（リスク調整後）
  - 月次利益 > ガス代
  - 元本保全（清算回避）
  - 複利効果の最大化

成功基準:
  - 初期: 月$10以上の純利益
  - 中期: 月$100以上の純利益
  - 長期: 月$1,000以上の純利益

毎月レポート:
  - 預入総額
  - 獲得報酬
  - ガス代支出
  - 純利益（報酬 - ガス代）
  - APY実績 vs 目標
```

---

## 残高チェック（MUST - 全操作前に必須）

```yaml
操作前チェック:
  1. 残高確認
     - 必要額 + ガス代 <= 利用可能残高
     - 不足 → 操作拒否

  2. 健全性確認（借入時）
     - Health Factor > 1.5 を維持
     - 清算リスク → 操作拒否

  3. ガス代効率
     - 操作コスト vs 期待利益
     - ガス代 > 1ヶ月の利益 → 警告

残高不足時の対応:
  「❌ 残高不足のため操作できません。

   必要額: $500 + ガス代 ~$10
   現在残高: $300
   不足額: ~$210

   入金するか、操作額を減らしてください。」

ガス代警告:
  「⚠️ ガス代が高い状態です。

   現在のガス代: ~$50
   1ヶ月の期待利益: ~$30

   ガス代が下がるまで待つことを推奨します。
   続行しますか？」
```

## ⚠️ 重要警告

```
このスキルは高リスク操作を含みます。

MUST:
├── 損失リスクを理解した上で使用
├── 投資は自己責任
├── 少額から開始を推奨
└── 大口操作は監督者承認必須
```

---

## 承認レベル

```yaml
Level 0 - 自動実行OK:
  ✅ ポジション確認
  ✅ APY確認
  ✅ Health Factor確認
  ✅ 報酬確認

Level 1 - 確認表示（自動実行可）:
  ⚠️ 報酬のクレーム（$100未満）
  ⚠️ 小額の預入（$100未満、Tier1プロトコル）

Level 2 - 監督者承認必須:
  🔒 預入（$100以上）
  🔒 引出
  🔒 借入（Borrow）
  🔒 返済（Repay）
  🔒 スワップ

Level 3 - 明示的許可 + 二重確認:
  🔐 大口操作（$1,000以上）
  🔐 Tier2/3プロトコルへの操作
  🔐 レバレッジ操作
  🔐 清算リスクのある操作

監督者承認フロー:
  1. MoltBotが操作内容とリスクを提示
  2. 監督者が「OK」「承認」で許可
  3. 許可後5分以内に実行
  4. 完了報告 + 新しいポジション状態
```

---

## 対応プロトコル

### Tier 1: 最高セキュリティ（推奨）

| プロトコル | TVL | 監査 | APY目安 |
|-----------|-----|------|---------|
| **AAVE** | $40B+ | 複数 | 4-7% |
| **Compound** | $5B+ | 複数 | 3-6% |
| **MakerDAO** | $8B+ | 複数 | 5-8% |
| **Lido** | $30B+ | 複数 | 3-4% |

### Tier 2: 高セキュリティ

| プロトコル | TVL | 監査 | APY目安 |
|-----------|-----|------|---------|
| **Curve** | $2B+ | 複数 | 5-15% |
| **Yearn** | $500M+ | 複数 | 5-10% |
| **Convex** | $3B+ | 複数 | 8-15% |

### Tier 3: 要注意

```
⚠️ 以下は高リスク:
├── 新規プロトコル（TVL $100M未満）
├── 監査なしのプロトコル
├── 異常に高いAPY（50%+）
└── 複雑なトークノミクス
```

---

## 戦略カテゴリ

### 1. 安全重視戦略（推奨）

```yaml
Low Risk Strategy:
  target_apy: 4-8%
  assets: USDC, USDT, DAI
  protocols:
    - AAVE (Supply)
    - Compound (Supply)
    - MakerDAO DSR
  risk_level: ★☆☆☆☆
  min_investment: $100
  recommended_for: 初心者、長期運用
```

### 2. バランス戦略

```yaml
Medium Risk Strategy:
  target_apy: 8-15%
  assets: USDC, ETH, stETH
  protocols:
    - Curve (LP)
    - Convex (Boosted)
    - Yearn Vaults
  risk_level: ★★★☆☆
  min_investment: $1,000
  recommended_for: 中級者、分散投資
```

### 3. 高リターン戦略（高リスク）

```yaml
High Risk Strategy:
  target_apy: 15-30%+
  assets: Various
  protocols:
    - New DeFi protocols
    - Leveraged positions
    - Complex strategies
  risk_level: ★★★★★
  min_investment: $5,000
  recommended_for: 上級者のみ
  warning: 元本損失リスク高
```

---

## 推奨戦略詳細

### Strategy A: ステーブルコイン安定運用

```
目標APY: 5-8%
リスク: 低

配分:
├── AAVE (USDC Supply): 40%
├── Compound (USDC Supply): 30%
├── MakerDAO DSR (DAI): 30%

メリット:
├── 価格変動リスクなし
├── 大手プロトコル使用
├── 監査済み
└── 流動性高い

デメリット:
├── APYが低め
├── ガス代で利益減少
└── スマートコントラクトリスクあり
```

### Strategy B: ETHステーキング

```
目標APY: 3-5%
リスク: 低-中

配分:
├── Lido (stETH): 70%
├── AAVE (stETH担保でUSDC借入): 30%

メリット:
├── ETH価格上昇の恩恵
├── ステーキング報酬
├── 流動性維持（stETH）
└── 担保としても使用可能

デメリット:
├── ETH価格下落リスク
├── スラッシングリスク（低）
└── stETHのデペグリスク（低）
```

### Strategy C: Curve LP戦略

```
目標APY: 8-15%
リスク: 中

配分:
├── Curve 3pool (USDC/USDT/DAI): 50%
├── Convex (Boosted rewards): 50%

メリット:
├── 比較的高APY
├── CRV報酬
├── インパーマネントロス低（ステーブル同士）
└── 複利効果（Convex）

デメリット:
├── 複雑な報酬構造
├── CRV価格依存
└── ガス代が高い
```

---

## リスク管理

### リスク評価マトリクス

| リスク種類 | 説明 | 対策 |
|-----------|------|------|
| スマートコントラクト | バグ、ハッキング | 監査済みプロトコルのみ |
| インパーマネントロス | LP価格差損失 | ステーブルペアを選択 |
| 清算リスク | 担保価値下落 | Health Factor 1.5以上維持 |
| デペグリスク | ステーブル乖離 | 複数ステーブル分散 |
| 規制リスク | 法規制変更 | 主要プロトコル優先 |

### Health Factor管理（AAVE等）

```
Health Factor = 担保価値 / 借入額

推奨値:
├── 2.0以上: 安全（推奨）
├── 1.5-2.0: 注意
├── 1.0-1.5: 危険（清算リスク）
└── 1.0以下: 清算

自動アクション:
├── HF < 1.5 → 警告通知
├── HF < 1.3 → 返済を提案
├── HF < 1.1 → 緊急対応（監督者に即連絡）
```

---

## 自動リバランス

### 条件付きリバランス

```
トリガー条件:
├── APY差が2%以上開いた場合
├── 配分が目標から10%以上ずれた場合
├── 新しい高APY機会が出現（検証済みプロトコル）
├── リスク指標が悪化した場合
└── ガス代が十分安い時（$10以下）

リバランス手順:
1. 現在のポジションを分析
2. 最適配分を計算
3. ガス代を見積もり
4. 監督者に提案
5. 承認後に実行
6. 結果を報告
```

---

## 操作フロー

### 初期設定

```
ユーザー: 「DeFiで運用を始めたい」

MoltBot:
1. リスク許容度を確認
2. 投資額を確認
3. 戦略を提案
4. 承認を得る

返答:
「📊 DeFi運用プランを作成しました:

投資額: $1,000
戦略: ステーブルコイン安定運用
期待APY: 5-7%
年間収益予測: $50-70

配分案:
・AAVE (USDC): $400 (40%)
・Compound (USDC): $300 (30%)
・MakerDAO DSR: $300 (30%)

この配分で開始しますか？」
```

### 日次レポート

```
「📈 DeFi運用レポート（日次）

ポートフォリオ価値: $1,015.23 (+1.52%)

各ポジション:
・AAVE: $406.10 (APY 5.2%)
・Compound: $303.05 (APY 4.8%)
・MakerDAO: $306.08 (APY 6.0%)

今日の収益: $0.42
累計収益: $15.23

リスク指標: ✅ 正常
次回リバランス推奨: なし」
```

---

## ガス代最適化

### 実行タイミング

```
推奨実行時間:
├── 日本時間 早朝 (5-7時) → ガス安め
├── 週末 → ガス安め
├── ガス代$10以下を待つ

避けるべき時間:
├── NY市場オープン時
├── 大型イベント時
├── ネットワーク混雑時
```

### バッチ処理

```
複数操作をまとめて実行:
├── 複数プロトコルへの預入を1トランザクションに
├── 報酬クレームをまとめて実行
├── リバランスは一括で
```

---

## 警告・通知

### 自動通知条件

```
即時通知:
├── 🚨 清算リスク（HF < 1.3）
├── ⚠️ デペグ検出（1%以上乖離）
├── ⚠️ プロトコル障害
├── 📉 大幅なAPY低下（-50%以上）
└── 🔔 リバランス推奨

日次通知:
├── 📊 ポートフォリオサマリー
├── 💰 収益レポート
└── 📈 市場動向
```

---

## 禁止事項

```
❌ 未監査プロトコルの使用
❌ 異常に高いAPY（50%+）への投資
❌ レバレッジ10倍以上
❌ 監督者承認なしでの大額移動（$500以上）
❌ ラグプル疑惑のあるプロトコル
❌ 新規トークンへの投資（上場1ヶ月未満）
```

---

## 連携スキル

| スキル | 連携内容 |
|--------|----------|
| `metamask-wallet` | ウォレット操作 |
| `web-search` | プロトコル調査 |
| `deep-research` | 戦略分析 |
| `revenue-tracker` | 収益追跡 |
| `analytics-tracker` | パフォーマンス分析 |

---

## 免責事項

```
⚠️ 重要な注意事項:

1. 暗号資産投資は元本保証されません
2. DeFiには技術的リスクが伴います
3. 過去のAPYは将来を保証しません
4. 投資は自己責任で行ってください
5. 失っても問題ない金額のみ投資してください
6. 税務上の扱いは専門家に相談してください

このスキルは情報提供を目的としており、
投資助言ではありません。
```

---

## 更新履歴

```
[2026-02-02] 初期作成
```

---

*DeFi運用は慎重に。必ず監督者の承認を得てから実行してください。*
