---
name: metamask-wallet
description: MetaMask wallet integration for crypto payments, DeFi interactions, and receiving rewards. Requires METAMASK_PASSWORD in secrets.
auto_trigger: false
---

# MetaMask Wallet Integration

MetaMask連携スキル。暗号資産の送受信、DeFi操作、報酬受け取り。

## 必要な環境変数

```bash
METAMASK_PASSWORD     # MetaMaskパスワード（設定済み）
METAMASK_SEED_PHRASE  # シードフレーズ（オプション、復元用）
```

---

## 目標

```yaml
最優先目標: 利益を出すこと

指標:
  - 月次収益（受け取り - 支出 - ガス代）
  - ROI（投資収益率）
  - DeFi報酬額
  - 取引成功率

毎月レポート:
  - 総収入
  - 総支出
  - 純利益
  - 改善点
```

---

## セキュリティルール（MUST）

### 絶対禁止

```
❌ シードフレーズをログに出力
❌ 秘密鍵を外部に送信
❌ パスワードを平文で保存
❌ 不審なコントラクトとの対話
❌ 未検証のDAppへの接続
❌ 監督者の承認なしでの大量送金
❌ 残高不足での操作実行
```

### 残高チェック（MUST - 全操作前に必須）

```yaml
送金前チェック:
  1. 送金額 + ガス代 <= 利用可能残高 か確認
  2. 不足の場合 → 操作拒否 + 残高不足を報告
  3. ギリギリの場合（残り10%未満）→ 警告表示

DeFi操作前チェック:
  1. 必要額 + ガス代 <= 利用可能残高 か確認
  2. 清算リスク（Health Factor）を確認
  3. 不足/リスクあり → 操作拒否

エラーメッセージ例:
  「❌ 残高不足です。
   ・必要額: 0.5 ETH + ガス代 ~$5
   ・現在残高: 0.3 ETH
   ・不足額: ~0.2 ETH (~$600)

   入金後に再度お試しください。」
```

### 承認レベル

```yaml
Level 0 - 自動実行OK:
  ✅ 残高確認
  ✅ トランザクション履歴確認
  ✅ ガス代見積もり
  ✅ 報酬の受け取り（Fiverr等からの入金）
  ✅ エアドロップのクレーム

Level 1 - 確認表示（自動実行可）:
  ⚠️ 小額の送金（$100未満、設定済みアドレスへ）
  → 金額とアドレスを表示して5秒待機、キャンセルなければ実行

Level 2 - 監督者承認必須:
  🔒 送金（$100以上）
  🔒 新しいDAppへの接続
  🔒 コントラクト承認（Approve）
  🔒 新しいネットワーク追加
  🔒 DeFi操作（Supply/Borrow/Swap等）

Level 3 - 明示的許可 + 二重確認:
  🔐 大口送金（$1,000以上）
  🔐 全額引き出し
  🔐 シードフレーズを使う操作
```

### 承認フロー

```yaml
$100以上の送金:
  1. MoltBotが送金内容を提示
  2. 監督者が「OK」「承認」「やって」等で許可
  3. 許可を受けたら実行
  4. 完了報告

$1,000以上の大口送金:
  1. MoltBotが送金内容を提示 + リスク警告
  2. 監督者が明示的に承認（「$X送金を承認」）
  3. 再確認「本当に$Xを送金しますか？」
  4. 監督者が再度確認
  5. 実行 → 完了報告

監督者承認の有効期限:
  - 承認から5分以内に実行
  - 5分超過で再承認が必要
  - 金額変更があれば再承認が必要
```

### 累積監視（セキュリティ）

```yaml
24時間以内の累積監視:
  - 小額送金の合計が$500超 → 警告 + 承認必須に格上げ
  - 同一アドレスへの連続送金 → 確認
  - 新規アドレスへの送金 → Level 2に格上げ

異常検出:
  - 普段と異なる時間帯の操作 → 確認
  - 普段と異なる金額パターン → 確認
  - 短時間での連続送金 → 一時停止
```

---

## 機能一覧

### 1. ウォレット管理

```
基本操作:
├── 残高確認（ETH、ERC-20トークン）
├── アドレス取得
├── トランザクション履歴
├── ガス代見積もり
└── ネットワーク切り替え
```

### 2. 送受信

```
送金:
├── ETH送金
├── ERC-20トークン送金
├── NFT転送
├── バッチ送金（複数宛先）
└── 予約送金（条件付き）

受取:
├── 報酬受け取り（Fiverr、ココナラ等からの暗号資産）
├── DeFi報酬のクレーム
├── エアドロップ確認
└── ステーキング報酬
```

### 3. DeFi連携

```
対応プロトコル:
├── AAVE（レンディング）
├── Compound（レンディング）
├── Uniswap（スワップ）
├── Curve（ステーブルスワップ）
├── Lido（リキッドステーキング）
└── Yearn（イールドアグリゲーター）
```

---

## 操作フロー

### 残高確認

```
ユーザー: 「MetaMaskの残高を確認して」

MoltBot:
1. MetaMask APIに接続
2. 残高を取得
3. 報告

返答:
「💰 MetaMask残高:
・ETH: 0.5 ETH (~$1,500)
・USDC: 500 USDC
・USDT: 200 USDT
・合計: ~$2,200」
```

### 送金（承認必須）

```
ユーザー: 「0.1 ETHを〇〇に送って」

MoltBot:
1. 送金内容を確認
2. ガス代を見積もり
3. 承認をリクエスト

返答:
「📤 送金リクエスト:
・宛先: 0x1234...5678
・金額: 0.1 ETH (~$300)
・ガス代: ~$5
・合計: ~$305

承認しますか？ [Yes/No]」

[承認後]
「✅ 送金完了！
・TX Hash: 0xabcd...
・Etherscan: https://etherscan.io/tx/0xabcd...」
```

### 報酬受け取り

```
ユーザー: 「Fiverrからの報酬を受け取って」

MoltBot:
1. 報酬トランザクションを確認
2. 受け取り処理
3. 残高更新を報告

返答:
「💰 報酬受け取り完了！
・金額: 50 USDC
・送信元: Fiverr
・新残高: 550 USDC」
```

---

## 対応ネットワーク

| ネットワーク | Chain ID | 用途 |
|-------------|----------|------|
| Ethereum Mainnet | 1 | メイン |
| Polygon | 137 | 低ガス |
| Arbitrum | 42161 | L2 |
| Optimism | 10 | L2 |
| Base | 8453 | Coinbase L2 |
| BSC | 56 | Binance |

---

## ガス代最適化

### 自動最適化

```
ガス代戦略:
├── 急ぎでない → Low ガス設定
├── 通常 → Medium ガス設定
├── 急ぎ → High ガス設定
├── ガス高騰時 → 待機を提案
└── L2利用可能 → L2経由を提案
```

### ガス監視

```
条件付き実行:
├── ガス代が$10以下になったら実行
├── 特定時間帯に実行（深夜等）
├── 優先度低いTXは後回し
└── バッチ処理でガス節約
```

---

## トランザクション追跡

### 状態監視

```
TX状態:
├── Pending（保留中）
├── Confirmed（確認済み）
├── Failed（失敗）
└── Dropped（ドロップ）

失敗時の対応:
├── ガス不足 → 再送信を提案
├── Nonce問題 → 修正して再送
├── コントラクトエラー → 原因分析
└── リバート → 理由を報告
```

---

## DeFi操作（監督者承認必須）

### AAVE レンディング

```
操作:
├── 預入（Supply）
├── 借入（Borrow）
├── 返済（Repay）
├── 引出（Withdraw）
└── 担保管理

確認事項:
├── APY確認
├── 健全性比率（Health Factor）
├── 清算リスク評価
└── ガス代見積もり
```

### Uniswap スワップ

```
操作:
├── トークン交換
├── スリッページ設定
├── 価格インパクト確認
└── 最適ルート選択
```

---

## 報酬受け取り対応プラットフォーム

| プラットフォーム | 対応通貨 | 方法 |
|-----------------|---------|------|
| Fiverr | USDC, ETH | 直接送金 |
| Upwork | USDC | 直接送金 |
| Web3ジョブ | 各種トークン | コントラクト |
| エアドロップ | 各種 | クレーム |
| DeFi報酬 | 各種 | クレーム |

---

## エラーハンドリング

### よくあるエラー

| エラー | 原因 | 対処 |
|--------|------|------|
| Insufficient funds | 残高不足 | 入金を促す |
| Gas too low | ガス設定が低い | 再見積もり |
| Nonce too low | Nonce競合 | リセット |
| Transaction reverted | コントラクトエラー | 原因分析 |
| Network error | 接続問題 | 再試行 |

---

## 監査ログ

### 全操作を記録

```
記録内容:
├── 日時
├── 操作種類
├── 金額
├── 宛先/送信元
├── TX Hash
├── ガス代
├── 結果（成功/失敗）
└── 承認者（監督者/自動）
```

### レポート

```
日次レポート:
├── 総入金額
├── 総出金額
├── ガス代合計
├── DeFi収益
└── 残高変動
```

---

## 連携スキル

| スキル | 連携内容 |
|--------|----------|
| `defi-optimizer` | DeFi戦略実行 |
| `revenue-tracker` | 収益追跡 |
| `fiverr-seller` | 報酬受け取り |
| `coconala-seller` | 報酬受け取り |
| `trading-bot` | 自動取引 |

---

## 使用例

```
「残高確認して」→ 全トークン残高を表示
「0.1 ETH送って」→ 承認後に送金
「AAVEに預けて」→ レンディング操作（承認必須）
「報酬クレームして」→ DeFi報酬を受け取り
「ガス代いくら？」→ 現在のガス代を表示
```

---

## 更新履歴

```
[2026-02-02] 初期作成
```

---

*暗号資産の操作は慎重に。大きな金額は必ず監督者の承認を得てください。*
